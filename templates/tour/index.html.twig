{% extends 'base.html.twig' %}

{% block title %}Tour index{% endblock %}

{% block body %}

{# Full-viewport background layer #}
<div style="position:fixed; inset:0; background: linear-gradient(180deg,#333333 0%, #222222 100%); z-index:0;"></div>

{# Main content sits above the background #}
<div class="relative z-10 min-h-screen text-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-20 pb-20">

    {# Header area #}
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-8">
      <div class="text-center md:text-left">
        <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight text-white mb-2">
          Tour Index
        </h1>
        <p class="text-gray-400 max-w-xl">
          A curated list of scheduled tours. Use the actions to view or edit details.
          {% if q is defined and q %}
            <span class="ml-2 text-neutral-300">Search: “<span class="font-semibold">{{ q }}</span>”</span>
          {% endif %}
        </p>
      </div>

      <div class="flex items-center gap-4 justify-center md:justify-end">
        {# Search (functional) #}
        <form method="get" action="{{ path('app_tour_index') }}" class="relative">
          <input
            type="search"
            name="q"
            value="{{ q|default('') }}"
            placeholder="Search tours..."
            aria-label="Search tours"
            class="w-64 sm:w-80 rounded-lg bg-neutral-800 text-neutral-100 placeholder:text-neutral-400 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500 transition" />
          <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 p-1 text-neutral-400 hover:text-neutral-200">
            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M17.65 11a6.65 6.65 0 11-13.3 0 6.65 6.65 0 0113.3 0z" />
            </svg>
          </button>
        </form>

        {% if q is defined and q %}
          <a href="{{ path('app_tour_index') }}"
             class="inline-flex items-center gap-2 bg-transparent border border-neutral-700 text-neutral-100 py-2 px-3 rounded-lg hover:bg-neutral-800 transition">
            Clear
          </a>
        {% endif %}

        <a href="{{ path('app_tour_new') }}" class="inline-flex items-center gap-3 bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white font-semibold py-3 px-5 rounded-lg shadow-lg transition">
          <span class="text-xl leading-none">+</span>
          <span class="hidden sm:inline">Create New Tour</span>
        </a>

        {# Optional: show logged-in user's email (if available) #}
        {% if app.user is defined and app.user.email is defined %}
          <div class="hidden sm:inline-flex items-center px-3 py-2 rounded-lg bg-neutral-800 border border-neutral-700 text-sm text-neutral-200">
            {{ app.user.email }}
          </div>
        {% endif %}

        {# Logout form (POST) - safe logout for Symfony #}
        <form action="{{ path('app_logout') }}" method="post" class="inline-block">
          <input type="hidden" name="_csrf_token" value="{{ csrf_token('logout') }}">
          <button type="submit" class="ml-2 inline-flex items-center gap-2 bg-transparent border border-neutral-700 text-neutral-100 py-2 px-3 rounded-lg hover:bg-neutral-800 transition">
            Logout
          </button>
        </form>
      </div>
    </div>

    {# Card containing the table #}
    <div class="mx-auto max-w-6xl">
      <div class="overflow-hidden rounded-2xl shadow-2xl" style="background: rgba(20,20,20,0.55); border: 1px solid rgba(255,255,255,0.03);">
        <div class="p-4 sm:p-6">
          <div class="overflow-x-auto">
            <table class="min-w-full table-auto">
              <thead class="bg-neutral-900/60">
                <tr>
                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Id</th>
                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Name</th>
                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Email</th>

                  {# new exhibition header #}
                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Exhibition</th>

                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Phone</th>
                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Guests</th>
                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Date</th>
                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Notes</th>
                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Status</th>
                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Created</th>
                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Updated</th>
                  <th class="px-6 py-3 text-center text-xs font-semibold text-neutral-300 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>

              <tbody class="divide-y divide-neutral-800">
                {% if tours is empty %}
                  <tr>
                    <td colspan="12" class="px-6 py-10 text-center text-gray-400">
                      {% if q is defined and q %}
                        No results for “{{ q }}”.
                      {% else %}
                        No records found.
                      {% endif %}
                    </td>
                  </tr>
                {% else %}
                  {% for tour in tours %}
                    <tr class="odd:bg-neutral-800 even:bg-neutral-900/60 hover:bg-neutral-700 transition-colors">
                      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white text-center">{{ tour.id }}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-200 text-center">{{ tour.name }}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-200 text-center">{{ tour.email }}</td>

                      {# exhibition column - show title + small muted meta #}
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-200 text-center">
                        {% if tour.exhibition %}
                          <div class="font-medium text-white">{{ tour.exhibition.title }}</div>
                          <div class="text-xs text-neutral-400">
                            {{ tour.exhibition.type ?: '' }}{% if tour.exhibition.period %} — {{ tour.exhibition.period }}{% endif %}
                          </div>
                        {% else %}
                          <span class="text-neutral-500">—</span>
                        {% endif %}
                      </td>

                      <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-200 text-center">{{ tour.phoneNumber|default('—') }}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-200 text-center">{{ tour.numberOfGuests }}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-200 text-center">{{ tour.date ? tour.date|date('Y-m-d H:i') : 'N/A' }}</td>
                      <td class="px-6 py-4 text-sm text-neutral-200 max-w-xs truncate text-center">{{ tour.notes|default('—') }}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-200 text-center">{{ tour.status }}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-200 text-center">{{ tour.createdAt ? tour.createdAt|date('Y-m-d H:i') : 'N/A' }}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-200 text-center">{{ tour.updatedAt ? tour.updatedAt|date('Y-m-d H:i') : 'N/A' }}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium space-x-2">
                        <a href="{{ path('app_tour_show', {'id': tour.id}) }}" class="text-indigo-400 hover:text-indigo-300 font-semibold">Show</a>
                        <span class="text-neutral-500">|</span>
                        <a href="{{ path('app_tour_edit', {'id': tour.id}) }}" class="text-amber-400 hover:text-amber-300 font-semibold">Edit</a>
                      </td>
                    </tr>
                  {% endfor %}
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>

        {# optional footer with pagination placeholder #}
        <div class="px-4 py-3 border-t border-neutral-800 flex items-center justify-between">
          <div class="text-sm text-neutral-400">
            Showing {{ tours|length }} result{{ tours|length == 1 ? '' : 's' }}{% if q is defined and q %} for “{{ q }}”{% endif %}
          </div>
          <div class="flex items-center gap-2">
            <button class="px-3 py-1 rounded-lg bg-neutral-800 text-neutral-300 hover:bg-neutral-700" disabled>Prev</button>
            <button class="px-3 py-1 rounded-lg bg-neutral-800 text-neutral-300 hover:bg-neutral-700" disabled>Next</button>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>

{% endblock %}
